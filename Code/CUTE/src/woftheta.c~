// // // // // // // // // // // // // // // // // // // // // // // // // // // //  //
// This is a function to be used in CUTE to weigh the galaxy pairs. The weighting is //
// the 1 + w(theta) ratio from the angular pair correlation function. This function	 //
// expects a header "woftheta.h"													 //
// // // // // // // // // // 								   // // // // // // //  //

#include <stdio.h>
#include "woftheta.h"
#include <math.h>
#define PI 3.14159265
double woftheta( double* pos1, double* pos2 )
{
double r1sq = pos1[0]*pos1[0] + pos1[1]*pos1[1] + pos1[2]*pos1[2];
double r2sq = pos2[0]*pos2[0] + pos2[1]*pos2[1] + pos2[2]*pos2[2];
double woftheta1 = 0;
double costheta = (pos1[0]*pos2[0] + pos1[1]*pos2[1] + pos1[2]*pos2[2])/pow((r1sq*r2sq),0.5);
double theta = acos(costheta) * 180.0 / PI;
if(theta>10.0)
{woftheta1 = 1;}
else
{
// first, let's locate the band theta falls in.
  double xx[] = {0,  1.26727800e-3,   1.59540850e-3,   2.00850000e-3,        2.52855200e-3,   3.18325850e-3,   4.00748500e-3,      5.04512450e-3,   6.35143550e-3,   7.99598350e-3,         1.00663445e-2,   1.26727800e-2,   1.59540850e-2,    2.00850000e-2,   2.52855200e-2,   3.18325850e-2,         4.00748500e-2,   5.04512450e-2,   6.35143550e-2,       7.99598350e-2,   1.00663445e-1,   1.26727800e-1,         1.59540850e-1,   2.00850000e-1,   2.52855200e-1,  3.18325850e-1,   4.00748500e-1,   5.04512450e-1,         6.35143550e-1,   7.99598350e-1,   1.00663445,       1.26727800,   1.59540850,   2.00850000,         2.52855200,   3.18325850,   4.00748500,       5.04512450,   6.35143550,   7.99598350,  10.10000000};
  double y[] = {1.34086794,  1.34881877,  1.36104718,  1.33141773,  1.33961938,        1.32984379,  1.32350764,  1.31510266,  1.30527955,  1.24937412,        1.21707012,  1.1969196 ,  1.17063995,  1.14601008,  1.11970078,        1.09542368,  1.07519675,  1.06148172,  1.04892469,  1.03941401,        1.0317762 ,  1.02581204,  1.02080322,  1.01690248,  1.01392283,        1.01144776,  1.00947427,  1.00782378,  1.00619241,  1.00487224,        1.00423443,  1.00365341,  1.00253189,  1.00169561,  1.00106032,        1.00073591,  1.00026264,  0.99996944,  0.99977533,  0.99972267};
int n=39;
int jl = 0;
int ju = n;
int jm = 0;
int ascnd = (xx[n]>xx[1]);
while (ju-jl>1)
	{
	jm = (ju+jl)/2;
	if ((theta>xx[jm])==ascnd)
		jl = jm;
	else 
		ju = jm;
	}
unsigned long j = jl;

//now to calculate from interpolation

woftheta1 = (y[j+1] - y[j])/(xx[j+1]-xx[j]) * theta + y[j+1] - (y[j+1]-y[j])/(xx[j+1]-xx[j])* xx[j+1];

}
// now last jl is the location of this x

//if((theta>5.550)&&(theta<5.552))
//{printf("theta is %f, and w(theta) is %f",theta, woftheta1);} 
return woftheta1;
}


